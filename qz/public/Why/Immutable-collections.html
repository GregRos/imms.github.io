<!DOCTYPE html>
<html><head><title>Immutable collections</title><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="Immutable collections"/><meta property="og:description" content="An immutable and persistent collection is one that can’t be changed, but still supports operations such as Add and Remove. Instead of actually changing the collection itself, these operations transform the collection, returning a new one with the desired modifications."/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="An immutable and persistent collection is one that can’t be changed, but still supports operations such as Add and Remove. Instead of actually changing the collection itself, these operations transform the collection, returning a new one with the desired modifications."/><meta name="generator" content="Quartz"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Why/Immutable-collections"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title "><a href="..">Imms</a></h1><div class="spacer mobile-only"></div><div class="search "><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="results-container"></div></div></div></div><div class="darkmode "><input class="toggle" id="darkmode-toggle" type="checkbox" tabindex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve"><title>Light mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"><title>Dark mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;API&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Collections&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Why&quot;,&quot;collapsed&quot;:true}]"><h1>Explorer</h1><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="API"><button class="folder-button"><span class="folder-title">API</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="API"><li><a href="../API/FSharp-Integration" data-for="API/FSharp-Integration">FSharp Integration</a></li><li><a href="../API/Helper" data-for="API/Helper">Helper</a></li><li><a href="../API/Indexing" data-for="API/Indexing">Indexing</a></li><li><a href="../API/Key-Semantics" data-for="API/Key-Semantics">Key Semantics</a></li><li><a href="../API/Operators" data-for="API/Operators">Operators</a></li><li><a href="../API/Optional" data-for="API/Optional">Optional</a></li><li><a href="../API/PowerLINQ" data-for="API/PowerLINQ">PowerLINQ</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Collections"><button class="folder-button"><span class="folder-title">Collections</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Collections"><li><a href="../Collections/ImmList" data-for="Collections/ImmList">ImmList</a></li><li><a href="../Collections/ImmMap" data-for="Collections/ImmMap">ImmMap</a></li><li><a href="../Collections/ImmSet" data-for="Collections/ImmSet">ImmSet</a></li></ul></div></li><li><div class="folder-outer "><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Why"><button class="folder-button"><span class="folder-title">Why</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Why"><li><a href="../Why/Immutable-collections" data-for="Why/Immutable-collections">Immutable collections</a></li><li><a href="../Why/Not-immutable-collections" data-for="Why/Not-immutable-collections">Not immutable collections</a></li></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container " aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../Why/">Why</a></div></nav><h1 class="article-title ">Immutable collections</h1><p class="content-meta ">Jan 02, 2024, 4 min read</p></div></div><article class="popover-hint"><p>An immutable and persistent collection is one that can’t be changed, but still supports operations such as <code>Add</code> and <code>Remove</code>.</p>
<p>Instead of actually changing the collection itself, these operations transform the collection, returning a <em>new</em> one with the desired modifications.</p>
<p>This rather intuitive behavior is very similar to how strings work in .NET. It’s also similar to how numbers work, for that matter.</p>
<p>This is how operations on immutable and persistent objects look like:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="csharp" data-theme="github-dark github-light"><code data-language="csharp" data-theme="github-dark github-light" style="display:grid;"><span data-line><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">/** String: **/</span></span>
<span data-line><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">var</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> str</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &quot;Hello World&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">;</span></span>
<span data-line><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">var</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> newStr</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> str </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &quot;!&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">;</span></span>
<span data-line><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">//still: str == &quot;Hello World&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">/** Integer: **/</span></span>
<span data-line><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">var</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> n</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> 5</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">;</span></span>
<span data-line><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">var</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> m</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> n </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> 1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">;</span></span>
<span data-line><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">//still: n == 5</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">/** Imms Collection: **/</span></span>
<span data-line><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">var</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> immList</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> ImmList.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Of</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">2</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">3</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">);</span></span>
<span data-line><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">var</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> newImmList</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> immList.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">AddLast</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">4</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">);</span></span>
<span data-line><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">//still: immList == [1, 2, 3]</span></span></code></pre></figure>
<p>In contrast, a <em>mutable</em> object behaves like this:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="csharp" data-theme="github-dark github-light"><code data-language="csharp" data-theme="github-dark github-light" style="display:grid;"><span data-line><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">var</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> mutableList</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> List</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">int</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">>() {</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">2</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">3</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">};</span></span>
<span data-line><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">mutableList.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Add</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">4</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">);</span></span>
<span data-line><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">//mutableList != [1, 2, 3] :(</span></span></code></pre></figure>
<p>In the latter example, the <code>mutableList</code> object has been mutated, and its original value information is gone.</p>
<p>Now, why is the behavior in the first example better than in the second one?</p>
<p>That’s a trick question, of course. It really isn’t. It’s just different. Both kinds of collections are useful in different circumstances.</p>
<h2 id="structural-sharing">Structural sharing<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#structural-sharing" class="internal alias"> §</a></h2>
<p>Strings achieve their persistence by directly copying the whole thing every time you transform it. This works well for small amounts of data, but is impractical and prohibitive for collections that can potentialy contain thousands of elements. It’s expensive in both time and memory.</p>
<p>The immutable and persistent collections provided by Imms support an optimization known as <em>structural sharing</em>. Basically, when you transform a collection (such as by adding an element to the end), the resulting collection shares almost all of its structure with the previous one, with only small differences.</p>
<p>So if you have a million collections, each with a million elements and each differing in only a single element, you can only require as much memory as ten collections, an incredible optimization.</p>
<h1 id="general-advantages">General Advantages<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#general-advantages" class="internal alias"> §</a></h1>
<p>These general advantages apply no matter what kind of code you’re writing.</p>
<h2 id="safer-code">Safer Code<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#safer-code" class="internal alias"> §</a></h2>
<p>Mutation makes code more error-prone and harder to analyze. Using immutable objects unless there is reason not to helps reduce the complexity of the program and can get rid of bugs before they appear.</p>
<h2 id="tight-control-over-state">Tight control over state<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#tight-control-over-state" class="internal alias"> §</a></h2>
<p>Since immutable collections cannot be changed, you can expose them (possibly in behind interfaces) without fear for the internal state of an object, while still giving the user the full functionality of the collection.</p>
<p>This is best illustrated with the familiar example of strings. If you expose a string, the user can build upon it and transform it, but can’t change it behind your back. If you expose a <code>List&lt;char></code>, however, the user can change it without your knowledge.</p>
<p>In contrast, if you expose it as <code>IEnumerable&lt;char></code>, the user can’t change it behind your back, but can’t leverage the unique functionality of a string either.</p>
<h2 id="thread-safety">Thread safety<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#thread-safety" class="internal alias"> §</a></h2>
<p>Since immutable collections cannot be changed, the thread safety of a single instance is not an issue. Any number of reading threads can be active at the same time without interfering with anything else.</p>
<p>Although multiple writing threads can run into problems of working on out-dated information, this can be solved with locks that never interfere with reading.</p>
<p>Furthermore, “changing” an immutable collection basically amounts to changing a reference, which is an atomic operation.</p>
<h2 id="sharing">Sharing<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#sharing" class="internal alias"> §</a></h2>
<p>If you want to use the same collection in different locations but don’t want mutations in one location to affect another, you have to copy it, which can be prohobitively expensive.</p>
<p>An immutable collection instance never changes, so it never needs to be copied. You can have references to it in multiple locations in your code without any danger.</p>
<h2 id="snapshots-and-history-tracking">Snapshots and history tracking<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#snapshots-and-history-tracking" class="internal alias"> §</a></h2>
<p>As an example, a persistent collection lets you use snapshots to perform history tracking. You can efficiently store snapshots of a collection as it changes.</p>
<h2 id="implement-other-immutable-objects">Implement other immutable objects<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#implement-other-immutable-objects" class="internal alias"> §</a></h2>
<p>While you can easily use immutable objects to implement mutable ones (and, in fact, your objects will be less error-prone for it), you cannot use mutable objects to implement immutable ones.</p>
<p>Thus, if you want to create an object that provides one or more of the above benefits, and you need to use a collection in that object, you’ll have to use one that’s immutable.</p>
<h2 id="more-reading">More Reading<a aria-hidden="true" tabindex="-1" data-no-popover="true" href="#more-reading" class="internal alias"> §</a></h2>
<p>For more discussion about mutability versus immutability, see the following related links:</p>
<ul>
<li><a href="https://scott.mn/2014/04/27/why_immutable_collections/" class="external alias">Why immutable collections?</a></li>
<li><a href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html" class="external alias">Objects Should Be Immutable</a></li>
<li><a href="http://www.ibm.com/developerworks/library/j-jtp02183/" class="external alias">Java theory and practice: To mutate or not to mutate?</a></li>
</ul></article></div><div class="right sidebar"><div class="graph "><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-1"><a href="#structural-sharing" data-for="structural-sharing">Structural sharing</a></li><li class="depth-0"><a href="#general-advantages" data-for="general-advantages">General Advantages</a></li><li class="depth-1"><a href="#safer-code" data-for="safer-code">Safer Code</a></li><li class="depth-1"><a href="#tight-control-over-state" data-for="tight-control-over-state">Tight control over state</a></li><li class="depth-1"><a href="#thread-safety" data-for="thread-safety">Thread safety</a></li><li class="depth-1"><a href="#sharing" data-for="sharing">Sharing</a></li><li class="depth-1"><a href="#snapshots-and-history-tracking" data-for="snapshots-and-history-tracking">Snapshots and history tracking</a></li><li class="depth-1"><a href="#implement-other-immutable-objects" data-for="implement-other-immutable-objects">Implement other immutable objects</a></li><li class="depth-1"><a href="#more-reading" data-for="more-reading">More Reading</a></li></ul></div></div><div class="backlinks "><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div></div><footer class><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.1.4</a>, © 2024</p><ul><li><a href="https://github.com/Gregros/imms">GitHub</a></li></ul></footer></div></body><script src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">// quartz/components/scripts/quartz/components/scripts/callout.inline.ts
function toggleCallout() {
  const outerBlock = this.parentElement;
  outerBlock.classList.toggle(`is-collapsed`);
  const collapsed = outerBlock.classList.contains(`is-collapsed`);
  const height = collapsed ? this.scrollHeight : outerBlock.scrollHeight;
  outerBlock.style.maxHeight = height + `px`;
  let current = outerBlock;
  let parent = outerBlock.parentElement;
  while (parent) {
    if (!parent.classList.contains(`callout`)) {
      return;
    }
    const collapsed2 = parent.classList.contains(`is-collapsed`);
    const height2 = collapsed2 ? parent.scrollHeight : parent.scrollHeight + current.scrollHeight;
    parent.style.maxHeight = height2 + `px`;
    current = parent;
    parent = parent.parentElement;
  }
}
function setupCallout() {
  const collapsible = document.getElementsByClassName(
    `callout is-collapsible`
  );
  for (const div of collapsible) {
    const title = div.firstElementChild;
    if (title) {
      title.removeEventListener(`click`, toggleCallout);
      title.addEventListener(`click`, toggleCallout);
      const collapsed = div.classList.contains(`is-collapsed`);
      const height = collapsed ? title.scrollHeight : div.scrollHeight;
      div.style.maxHeight = height + `px`;
    }
  }
}
document.addEventListener(`nav`, setupCallout);
window.addEventListener(`resize`, setupCallout);
</script><script type="module">import "/api-links.js";
          </script><script type="module">
          import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
          const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
          mermaid.initialize({
            startOnLoad: false,
            securityLevel: 'loose',
            theme: darkMode ? 'dark' : 'default'
          });
          document.addEventListener('nav', async () => {
            await mermaid.run({
              querySelector: '.mermaid'
            })
          });
          </script><script type="application/javascript">
          const socket = new WebSocket('ws://localhost:3001')
          socket.addEventListener('message', () => document.location.reload())
        </script><script src="../postscript.js" type="module"></script></html>